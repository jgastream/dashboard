<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JGAStream - Watch</title>
    <link rel="stylesheet" href="watch.css" />
  
</head>
<body>
  <header>JGAStream</header>

<div class="container">
  <a href="index.html" class="back">&larr; Back to Home</a>

  <h1 id="title">Loading...</h1>
  <p id="description" class="description"></p>
  <p class="meta"><strong>Genre:</strong> <span id="genre">--</span></p>
  <p class="meta"><strong>Uploaded:</strong> <span id="uploadDate">--</span></p>
  <p class="meta"><strong>Views:</strong> <span id="views">0</span></p>

  <div style="display: flex; gap: 10px; margin: 1rem 0;">
    <button onclick="shareMedia()" style="padding: 6px 14px; background: #007bff; color: #fff; border: none; border-radius: 5px;">ðŸ”— Share</button>
    <button onclick="reportMedia()" style="padding: 6px 14px; background: #dc3545; color: #fff; border: none; border-radius: 5px;">ðŸš© Report</button>
  </div>

  <div id="trailerContainer"></div>

  <div id="downloadSection">
    <h2>Download Links</h2>
    <ul id="downloadList"></ul>
  </div>
</div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import {
      getFirestore, doc, getDoc, updateDoc
    } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCJOb0p6KHwNXCFddQJJ1vk09oqozQjvNw",
      authDomain: "jahkid6i-e51aa.firebaseapp.com",
      projectId: "jahkid6i-e51aa",
      storageBucket: "jahkid6i-e51aa.appspot.com",
      messagingSenderId: "849738273147",
      appId: "1:849738273147:web:bff891dd76502870a36dde"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const params = new URLSearchParams(window.location.search);
    const mediaId = params.get("id");

    const titleEl = document.getElementById("title");
    const descEl = document.getElementById("description");
    const genreEl = document.getElementById("genre");
    const uploadEl = document.getElementById("uploadDate");
    const viewsEl = document.getElementById("views");
    const trailerContainer = document.getElementById("trailerContainer");
    const downloadList = document.getElementById("downloadList");

    async function loadMedia() {
      if (!mediaId) return;

      const docRef = doc(db, "media", mediaId);
      const snapshot = await getDoc(docRef);

      if (!snapshot.exists()) {
        titleEl.textContent = "Media not found";
        return;
      }

      const data = snapshot.data();
      titleEl.textContent = data.title;
      descEl.textContent = data.description || "No description available.";
      genreEl.textContent = (Array.isArray(data.genre) ? data.genre.join(", ") : data.genre) || "Unknown";
      uploadEl.textContent = data.timestamp?.toDate?.().toLocaleString() || "Unknown";
      viewsEl.textContent = data.downloads || 0;

      // Fetch or auto-fetch trailer
      let trailerId = data.trailerId || await fetchYouTubeTrailer(data.title);
      if (trailerId) {
        trailerContainer.innerHTML = `<iframe src="https://www.youtube.com/embed/${trailerId}" allowfullscreen allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe>`;
      } else {
        trailerContainer.innerHTML = `<p style="color:#888">No trailer found.</p>`;
      }

      // Downloads
      downloadList.innerHTML = "";

      if (data.type === "movie" && Array.isArray(data.urls)) {
        data.urls.forEach((url, i) => {
          const li = document.createElement("li");
          const a = document.createElement("a");
          a.href = url;
          a.target = "_blank";
          a.textContent = `Download Link ${i + 1}`;
          a.addEventListener("click", () => incrementDownload(mediaId));
          li.appendChild(a);
          downloadList.appendChild(li);
        });
      } else if (data.type === "series" && Array.isArray(data.seasons)) {
        data.seasons.forEach((season, i) => {
          const header = document.createElement("li");
          header.textContent = `â–¶ï¸ Season ${season.season || i + 1}`;
          header.style.fontWeight = "bold";
          header.style.cursor = "pointer";
          header.style.marginTop = "0.8rem";

          const epList = document.createElement("ul");
          epList.style.marginLeft = "1.2rem";
          epList.style.display = "none";

          season.episodes?.forEach((epUrl, j) => {
            const epLi = document.createElement("li");
            const epA = document.createElement("a");
            epA.href = epUrl;
            epA.target = "_blank";
            epA.textContent = `Episode ${j + 1}`;
            epA.addEventListener("click", () => incrementDownload(mediaId));
            epLi.appendChild(epA);
            epList.appendChild(epLi);
          });

          header.addEventListener("click", () => {
            epList.style.display = epList.style.display === "none" ? "block" : "none";
          });

          downloadList.appendChild(header);
          downloadList.appendChild(epList);
        });
      } else {
        downloadList.innerHTML = "<li>No download links found.</li>";
      }
    }

    async function fetchYouTubeTrailer(title) {
      const apiKey = "AIzaSyD9cgIY4Xyrc55c-ba8C5IwFM9mDbwCkWo";
      const query = encodeURIComponent(`${title} official trailer`);
      const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=1&q=${query}&key=${apiKey}`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        return data.items?.[0]?.id?.videoId || null;
      } catch (err) {
        console.error("YouTube fetch failed", err);
        return null;
      }
    }

    async function incrementDownload(id) {
      const docRef = doc(db, "media", id);
      const snap = await getDoc(docRef);
      if (snap.exists()) {
        const data = snap.data();
        const newCount = (data.downloads || 0) + 1;
        await updateDoc(docRef, { downloads: newCount });
        viewsEl.textContent = newCount;
      }
    }

    loadMedia();
    
    import {
  collection, addDoc, serverTimestamp
} from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

// Share button logic
window.shareMedia = () => {
  const url = window.location.href;
  navigator.clipboard.writeText(url)
    .then(() => alert("Link copied to clipboard!"))
    .catch(() => alert("Failed to copy link."));
};

// Report button logic
window.reportMedia = async () => {
  const reason = prompt("Why are you reporting this content?");
  if (!reason) return;

  try {
    await addDoc(collection(db, "reports"), {
      mediaId,
      reason,
      reportedAt: serverTimestamp()
    });
    alert("Report submitted. Thank you!");
  } catch (e) {
    alert("Failed to submit report.");
    console.error(e);
  }
};

  </script>
    <script type='text/javascript' src='//frozenbiopsyskate.com/eb/a8/04/eba804afa89e38e05f25507c6d76c9f1.js'></script>
</body>
    </html>
